<!DOCTYPE html>
<html >
<head>
  <meta charset="utf-8">
  <title>友影</title>
  <meta name="keywords" content="影视搜索">
  <meta name="description" content="影视搜索引擎">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/layui/css/layui.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/css/global.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/swiper/swiper.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/player/video-js.min.css">
  <link rel="shortcut icon" href=" https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/images/favicon.ico" />

  <style>
   html body{margin: 0px;padding: 0px}
  .fly-main{min-height: auto;width: 100%;}
  .layui-btn-normal{float: left;margin: 0.5rem;}
  .search{margin-top:3rem;}
  .search .keyword{height: 3rem ;border-radius: 2px}
  .search .submit{height: 3rem}
  .search-history .layui-btn{margin: 0.2rem;}


  .vlist{display: block;}
  .vlist .cover{min-height: 8rem;border-radius: 10px;}
  .vlist .dinfo{padding-left: 0.5rem;}
  .vlist .dinfo p{overflow: hidden;display: inline-block;width: 100%;height: 1.2rem;text-overflow: ellipsis;white-space: nowrap;}
  .vlist .dinfo h5{overflow: hidden;text-overflow: ellipsis;white-space: nowrap;margin-bottom: 0.5rem;}
  .vlist .title{font-weight: 700;font-size: 0.9rem;}

  @media screen and (min-width: 960px){
      .layui-card-body{height: 22rem;}
      .layui-card-body img{width: 100%;height: 21rem;display: block;}

  }
  @media screen and (max-width: 768px){
      .layui-card-body img{width: 100%;height: 7.01rem;display: block;}
      .vlist img{width: 100%;height: 10.66rem;display: block;}
  }

  .layui-card-body a{display: block;}
  .main-content{background: #FFFFFF;margin-top: 1rem;}
  .layui-tab-title li{min-width: 0px}
  #mov_category{z-index: 100000;background-color: white;}

   .layui-icon-more-vertical{
       font-size: 30px;
       color: #FFFFFF;
       left: 0px;
   }

   .top_menu_content{
       background: #FFFFFF;
       height: 100%;
       position: absolute;
       width: 96%;
       height: auto;
       Opacity:0.9;
       padding-top: 10px;
       z-index: 1000;
   }
    .top_menu_content .layui-card{margin-bottom: 0px;width: 100%}
    .top_menu_content .auth{margin-left: 2.3%;padding:0px;width: 95%}

   ._background-image {
       position: fixed;
       z-index: -1;
       width: 100%;
   }
  </style>
</head>
<body class="fly-full " style="overflow: hidden">

  <div style="height: 100%">
    <img src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/images/bg.jpg" class="_background-image">
  </div>

  <div class="layui-row " style="padding-left: 0.5rem;padding-right: 0.5rem" >

      <div class="layui-row " id="top_menu" >
          <div class="layui-box top_menu_content hidden"  >
              <div class="layui-box " >
                  <div class="layui-row user_login_status">
                      <script type="text/html" id="user_login_status">
                          {{#  if(d.islogin === true){ }}
                          <button type="button" class="layui-btn layui-btn-normal layui-btn-fluid auth" lay-type="home">个人中心</button>
                          {{# }else{ }}
                          <button type="button" class="layui-btn layui-btn-normal layui-btn-fluid auth" lay-type="auth">注册 / 登录</button>
                          {{# } }}
                      </script>
                  </div>
                  <div class="layui-row">
                      <div class="layui-card" datatype="today_update">
                          <div class="layui-card-header logout" >
                              <i class="layui-icon layui-icon-right" ></i>
                              今日更新
                          </div>
                      </div>
                      <div class="layui-card" datatype="hot_dy">
                          <div class="layui-card-header " >
                              <i class="layui-icon layui-icon-right" ></i>
                              热门电影
                          </div>
                      </div>
                      <div class="layui-card" datatype="hot_dsj">
                          <div class="layui-card-header " >
                              <i class="layui-icon layui-icon-right" ></i>
                              热门电视剧
                          </div>
                      </div>
                      <div class="layui-card" datatype="hot_zy">
                          <div class="layui-card-header " >
                              <i class="layui-icon layui-icon-right" ></i>
                              热门综艺
                          </div>
                      </div>
                      <div class="layui-card" datatype="hot_dm">
                          <div class="layui-card-header " >
                              <i class="layui-icon layui-icon-right" ></i>
                              热门动漫
                          </div>
                      </div>
                  </div>
              </div>
              <div class="layui-row slide_up" style="height: 30px;width: 100%;position: relative;top:0px;text-align: center;background: #FFFFFF;cursor: pointer">
                  <i class="layui-icon layui-icon-up" style="font-size: 20px;line-height: 36px"></i>
              </div>
          </div>
          <div class="layui-box top_menu_icon" style="position: absolute;left: 90%; top: 10px;">
              <i class="layui-icon layui-icon-more-vertical"></i>
          </div>
      </div>

      <div class="fly-main"  id="fly-main" style="margin: 0px">
          <!--logo-->
          <div class="layui-row" style="text-align: center">
              <div class="logo" style="height: 90px;text-align: center;padding-top: 5rem;color: #FFFFFF">
                  <!--			<img src="https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png2" />-->
                  <h2 style="margin:1rem 0;background: url(static/images/logo2.png) center no-repeat;height:40px;"></h2>

                  <p>全网影视资源搜索引擎，就要给你好看！</p>
              </div>
          </div>
          <!--search box-->
          <div class="layui-row search" >
              <form action="" class="layui-form search-form" >
                  <div class="layui-col-xs8 layui-col-sm8 layui-col-md8">
                      <input type="text" name="kw" required lay-verify="required" placeholder="开始搜搜吧" autocomplete="off" class="layui-input keyword" onfocusin="javascript:void(0);" onfocusout="javascript:void(0);" onfocus="javascript:void(0);" onblur="javascript:void(0);">
                  </div>
                  <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                      <button  class="layui-btn layui-btn-fluid submit" lay-submit lay-filter="seachSubmit" style="opacity:0.8;">搜索</button>
                  </div>
              </form>
          </div>
          <!--search result   -->
          <div class="layui-row main-content " id="main-content">

              <script type="text/html" id="vlistScript">

                  {{#  layui.each(d, function(index, item){ }}

                  <li>
                      <a href="javascript:void(0)" class="vlist" data="{{ item.id }}">
                          <div class="layui-row ">
                              <div class="layui-col-xs4 layui-col-sm4 layui-col-md4 cover" >
                                  <img class="lazy" src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics/static/images/default.png" data-echo="{{ conf.cover_host + item.cover_id }}" >
                              </div>
                              <div class="layui-col-xs8 layui-col-sm8 layui-col-md8 dinfo" >
                                  <h5 class="title">{{ item.title }}</h5>
                                  {{# if (item.year && item.year != ''){ }}
                                  <p>年份: {{ item.year }}</p>
                                  {{# }else{  }}
                                  <p>年份: 未知</p>
                                  {{# }  }}

                                  {{# if (item.area && item.area != ''){ }}
                                  <p>地区: {{ item.area }}</p>
                                  {{# }else{  }}
                                  <p>地区: 未知</p>
                                  {{# }  }}

                                  {{# if (item.director && item.director != ''){ }}
                                  <p>导演: {{ item.director }}</p>
                                  {{# }else{  }}
                                  <p>导演: 未知</p>
                                  {{# }  }}

                                  {{# if (item.actor && item.actor != ''){ }}
                                  <p>演员: {{ item.actor }}</p>
                                  {{# }else{  }}
                                  <p>演员: 未知</p>
                                  {{# }  }}

                                  {{# if (item.desc && item.desc != ''){ }}
                                  <p>简介: {{ item.desc }}</p>
                                  {{# }else{  }}
                                  <p>简介: 未知</p>
                                  {{# }  }}
                              </div>
                          </div>
                      </a>
                  </li>
                  {{# }) }}

              </script>

              <div class="layui-row" >
                  <div class="layui-tab layui-tab-brief" lay-filter="mov_category" id="mov_category">
                      <ul class="layui-tab-title hidden" >
                          <li class="layui-this">电影</li>
                          <li>电视剧</li>
                          <li>综艺</li>
                          <li>动漫</li>
                      </ul>
                      <div class="layui-tab-content hidden">
                      </div>
                  </div>
              </div>

              <div class="layui-row">
                  <div id="search_result_swpier" class="swiper-container hidden" >
                      <div class="swiper-wrapper">
                          <div class="swiper-slide" id="dy"><ul class="fly-case-list"></ul></div>
                          <div class="swiper-slide" id="dsj"><ul class="fly-case-list"></ul></div>
                          <div class="swiper-slide" id="zy"><ul class="fly-case-list"></ul></div>
                          <div class="swiper-slide" id="dm"><ul class="fly-case-list"></ul></div>
                      </div>
                  </div>
              </div>


          </div>

      </div>

  </div>




<script src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/mui/mui.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/js/global.js"></script>
<script src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/layui/layui.js"></script>
<script src="https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/swiper/swiper.min.js"></script>
<script>

	layui.config({
	  version: "3.0.0"
	  ,base: 'https://cdn.jsdelivr.net/gh/jyolo/mov_statics@d68c94e3a77ab06e4bb6e96c14cdbdeb170adff5/static/mods/' //这里实际使用时，建议改成绝对路径
	}).extend({
	  fly: 'index'
	}).use(['element','jquery','custom','util','laytpl'],function(){

        var $ = layui.jquery
		var element = layui.element
		var laytpl = layui.laytpl
		var util = layui.util
		var custom = layui.custom



        $('.top_menu_icon').on(click_event_type,function(){
            if($('.top_menu_content').css('display') == 'block'){
                $('.top_menu_content').slideUp()
            }else{
                $('.top_menu_content').slideDown();
                $(this).fadeOut()
            }
        })
        $('.slide_up').on(click_event_type,function () {
            $('.top_menu_content').slideUp()
            $('.top_menu_icon').fadeIn()
        })
        mui('.top_menu_content').on(click_event_type,'.layui-card',function(){
            layer.msg('尽请期待！');
			
        })



        window.render_login_status = function(){

            laytpl(user_login_status.innerHTML).render({'islogin': (localStorage.authToken != undefined) }, function(html){

                $('.user_login_status').find('.layui-btn').remove()
                $('.user_login_status').append(html)
                mui('.user_login_status').on(click_event_type,'.layui-btn',function(){
                   
                    switch ($(this).attr('lay-type')) {
                        case 'auth':
                            if((localStorage.authToken != undefined) == false){
                                mui.openWindow({
                                    id:'auth' ,
                                    url:'user/auth.html'
                                });
                            }else{
                                if(window.plus != undefined){
                                    home_webview = plus.webview.getWebviewById('home')
                                    mui.fire(home_webview,'checkLogin');
                                }
                                mui.openWindow({
                                    id:'home' ,
                                    url:'user/home.html'
                                });
                            }
                            break
                        case 'home':
                            if(window.plus != undefined){
                                home_webview = plus.webview.getWebviewById('home')
                                mui.fire(home_webview,'checkLogin');
                            }
                            mui.openWindow({
                                id:'home' ,
                                url:'user/home.html'
                            });
                            break;

                    }
					$('.top_menu_content').slideUp()
					$('.top_menu_icon').fadeIn()
				})

            });

        }
        render_login_status()
		window.addEventListener('refresh_login_status',function(event){
			render_login_status()
		})
		

		var animate_scrollTop_height = 300

        // $('#search_result_swpier').height(window.screen.height)

		// 初始化 获取列表的cache
		layui.cache.getListDataFuncArgs = {}
		var list_tpl = vlistScript.innerHTML
		var list_requst_url = '/v1/search'
		
		
		var backNum = 0
        mui.init({
            beforeback: function() {
                backNum++;
                if(backNum > 1) {
                    plus.runtime.quit();
                } else {
                    mui.toast("再按一次退出应用");
                }
                setTimeout(function() {
                    backNum = 0
                }, 2000);
                return false;

            }
        })

        // $('#fly-main').height($(window).height())


	   
        // 初始化选项卡的 swiper
        window.search_result_swpier = new Swiper('#search_result_swpier',{
            autoHeight: true,
            on: {
                slideChangeTransitionStart: function () {
                    $('.layui-tab-title').find('li').removeClass('layui-this');
                    $('.layui-tab-title').find('li').eq(this.activeIndex).addClass('layui-this');
                    layui.cache.current_data_type =  $('#search_result_swpier > .swiper-wrapper').find('.swiper-slide').eq(this.activeIndex).attr('id')

                    //首次切换过来没有数据的时候 加载一次数据
                    if(layui.cache.getListDataFuncArgs[layui.cache.current_data_type].page == 0 && $('#'+layui.cache.current_data_type).find('li').length == 0){
                        // 滚动到指定位置获取 数据
						// 当前选项卡 toend 赋值 false 主动触发 getListData
                        layui.cache.getListDataFuncArgs[layui.cache.current_data_type].toend = false
						$('html,body').animate({scrollTop: animate_scrollTop_height},100);
                        getListData()
						this.update()
					
                    }else{
						

                    }

                },
                slideChangeTransitionEnd:function(){
                    if(layui.cache.getListDataFuncArgs[layui.cache.current_data_type].scrollTop == undefined){
                    	$('html,body').animate({scrollTop: animate_scrollTop_height},100);
                    }else{
                    	// 不能小于298 否则贴不到 顶上
                    	if(layui.cache.getListDataFuncArgs[layui.cache.current_data_type].scrollTop < animate_scrollTop_height){
                    		layui.cache.getListDataFuncArgs[layui.cache.current_data_type].scrollTop = animate_scrollTop_height
                    	}
                    	$('html,body').animate({scrollTop: layui.cache.getListDataFuncArgs[layui.cache.current_data_type].scrollTop},10);
                    
                    }
					
                    this.update()
                }
            }
        })
		
		
        //监听 mov_category 点击
        element.on('tab(mov_category)', function(data){
            search_result_swpier.slideTo(data.index)
        })

		//固定Bar
		util.fixbar({
		  bgcolor: '#009688',
		  click: function(type){
			  
		  }
		});

		
		var getListData = function(){

            let params = layui.cache.form_data
            params.page = layui.cache.getListDataFuncArgs[layui.cache.current_data_type].page
            params.data_type = layui.cache.current_data_type

            var heards = {}
			if(isLogin){
			    var heards = {'Authorization':localStorage.authToken}
            }
			mui.ajax(conf.host + list_requst_url,{
				data:params,
				dataType:'json',//服务器返回json格式数据
				type:'get',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:heards,
				beforeSend:function(){

				    if($('#' + layui.cache.current_data_type).find('.layui-flow-more').length == 0){
                        $('#' + layui.cache.current_data_type).append(loading_dom)
                        search_result_swpier.update()

                    }

				},
				success:function(msg){

					if(msg.data.list.length > 0){

						layui.laytpl(list_tpl).render(msg.data.list, function(html){
                            $('#' + layui.cache.current_data_type).find('.layui-flow-more').remove()
                            $('#' + layui.cache.current_data_type).find('ul').append(html)

                            layui.cache.getListDataFuncArgs[layui.cache.current_data_type].toend = true
						});

					}else{
                        layui.cache.getListDataFuncArgs[layui.cache.current_data_type].toend = false

                        $('#' + layui.cache.current_data_type).find('.layui-flow-more').remove()
                        $('#' + layui.cache.current_data_type).append('<div class="layui-flow-more">没有更多了</div>')
					}

					
                    window.sticky.refresh()
					window.Echo.init()
                    search_result_swpier.update()
					

                },
				error:function(xhr,type,errorThrown){
					console.log(xhr)
				}
			});
		}
		

		
		window.form_submit = function(formData){
			
			//初始化 4个 选项卡的 cache
			$('#search_result_swpier').find('.swiper-slide').each(function (k,v) {
			    layui.cache.getListDataFuncArgs[ $(v).attr('id') ] = {page:0 ,toend:false}
			    if($(v).hasClass('swiper-slide-active')){
			        layui.cache.current_data_type = $(v).attr('id')
			    }else if(k == 0){
			        layui.cache.current_data_type = $(v).attr('id')
			    }
			})
			
			
			$('#search_result_swpier').removeClass('hidden')
			$('.layui-tab-title').removeClass('hidden')
			
			
			layui.cache.form_data = formData
			
			//清楚4个选项卡里面的所有li
			$('.fly-case-list').find('li').remove()
            // 搜索结果区最小高 ，否则不够高度向上滚动
			$('#search_result_swpier').css('min-height','800px')
			
            $('html,body').animate({scrollTop: animate_scrollTop_height},500);

			getListData()

			if(window.sticky == undefined){
				window.sticky = new hcSticky('#mov_category', {
				    stickTo: '#main-content',
				    top:-10
				});
			}else{
                window.sticky.refresh()
			}
			

			mui('#search_result_swpier').on(click_event_type,'.vlist',function(){
				
			    detail_id = this.getAttribute('data')
			    // localStorage.removeItem('watch_log_info')
			    setWatchLogger(detail_id ,function(msg){
					
					// if(window.plus != undefined){
					// 	detail_webview = plus.webview.getWebviewById('detail')
					// 	if(detail_webview != null){
					// 		mui.fire(detail_webview,'checkLogin')
					// 		mui.fire(detail_webview,'startPlay');
					// 		console.log(1111111)
					// 		mui.openWindow({
					// 			id:'detail' ,
					// 			url:'detail.html',
					// 		});
					// 	}else{
					// 		mui.openWindow({
					// 			id:'detail' ,
					// 			url:'detail.html',
					// 			extras:{
					// 				frist_enter:1
					// 			}
					// 		});
					// 	}
															
					// }else{
					// 	  mui.openWindow({
					// 		  id:'detail' ,
					// 		  url:'detail.html?id=' + detail_id
					// 	  });
					// }
														 
					
					
			        if(window.plus != undefined){
						
						localStorage.setItem('play_detail_id',detail_id)
						
			            detail_webview = plus.webview.getWebviewById('detail')
						
			            mui.fire(detail_webview,'checkLogin');
						mui.fire(detail_webview,'startPlay');
						mui.openWindow({
						    id:'detail' ,
						    url:'detail.html',
						});
			        }else{
						mui.openWindow({
						    id:'detail' ,
						    url:'detail.html?id=' + detail_id,
						});
					}
			
			        
					
			    })
				
				return false
			
			})
			

		
		}
		
		
		
		$('.search-form').on('submit',function(){
			p = $(this).serialize().split('=')

			if(p[1].indexOf('%') > -1){
				p[1] = decodeURIComponent(p[1])
			}
			
			form_submit({kw:p[1]})
			return false
		})
		
		
		// app 中事件 从 个人中心过来的 触发事件
		window.addEventListener('fromSearchHistory',function(event){
			//确保每个webview 的 window.isLogin 是 最新的状态
		
			var self = plus.webview.currentWebview();
			
			$('.keyword').val(event.detail.search_tag_value)
			
			
			$('.search-form').submit()
		
			
		})
		// H5 处理
		if(window.plus == undefined && custom.params.search_tag_value != undefined){
			// 从个人中心 搜索历史跳转过来的
			// kw 赋值
			$('.keyword').val(decodeURIComponent(custom.params.search_tag_value))
			//触发表单提交事件
			$('.search-form').submit()
		}


		$(window).scroll(
			function () {
				var scrollTop = $(window).scrollTop();
				var scrollHeight = $('#'+ layui.cache.current_data_type).height();
				var windowHeight = $(this).height();
                var current_data_type = layui.cache.current_data_type

				if(current_data_type != undefined){

					// 记录每个选项卡的滚动位置
					layui.cache.getListDataFuncArgs[current_data_type].scrollTop = scrollTop

					// 距离底部 还有100 px  （滚动高度 + 窗口高度 + 100 > 窗口高度）
					if (scrollTop + windowHeight + 100 >= scrollHeight && layui.cache.getListDataFuncArgs[current_data_type].toend == true) {
					    layui.cache.getListDataFuncArgs[current_data_type].toend=false;
						// 分页 + 1
						layui.cache.getListDataFuncArgs[current_data_type].page = layui.cache.getListDataFuncArgs[current_data_type].page + 1
						getListData()
					}

				}

			}
		);

		
	});


</script>

</body>
</html>